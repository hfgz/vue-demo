webpackJsonp([2],{"BJ+N":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=new(s("7+uW").default),i=s("UgCr"),a={name:"BatchWeightAdjust",data:function(){return{boxType:1,ipAndPort:"",weight:"",showBox:!1,isSubmit:!1}},computed:{windowTitle:function(){var t="";switch(this.boxType){case 1:t="批量权重调整";break;case 2:t="权重调整"}return t}},methods:{saveHandle:function(){this.isSubmit=!this.isSubmit;var t={weight:this.weight};1!==this.boxType&&(t.nodeList=[{ipAndPort:this.ipAndPort}]);var e=this.verifyRequestParams(t);0==e.code?n.$emit("batchWeightData",t,this.boxType):CallWeakHint(e.msg,"btn-error")},verifyRequestParams:function(t){return this.checkDispatch("weight",t.weight)?{code:0}:{code:1,msg:"只支持大于0的整数，请检查输入"}},checkDispatch:function(t,e){var s=!0;switch(t){case"weight":s=this.checkWeight(e)}return s},cancelHandle:function(){this.showBox=!1},show:function(t,e){this.showBox=!0,this.boxType=t,e?(this.weight=e.weight,this.ipAndPort=e.ipAndPort):this.weight=""},checkWeight:function(t){return!!/^\+?[1-9]\d*$/.test(t)}}},o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"show",rawName:"v-show",value:t.showBox,expression:"showBox"}],staticClass:"addOrUpdata"},[s("div",{staticClass:"window-testList-contailner"},[s("div",{staticClass:"header"},[s("span",{staticClass:"insert-title"},[t._v(t._s(t.windowTitle))]),t._v(" "),s("span",{staticClass:"insert-close-icon",on:{click:t.cancelHandle}},[t._v("×")])]),t._v(" "),s("ul",{staticClass:"window-testList-content"},[s("li",{staticClass:"li-item"},[s("span",[t._v("权重：")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.weight,expression:"weight",modifiers:{trim:!0}}],staticClass:"sn-input-testList",class:{errorInout:t.isSubmit&&!t.checkWeight(t.weight)},attrs:{type:"text"},domProps:{value:t.weight},on:{input:function(e){e.target.composing||(t.weight=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})])]),t._v(" "),s("div",{staticClass:"footer"},[s("button",{staticClass:"queryBtn",on:{click:t.saveHandle}},[t._v("保存")]),t._v(" "),s("button",{staticClass:"clearBtn",on:{click:t.cancelHandle}},[t._v("取消")])])])])},staticRenderFns:[]};var c=s("VU/8")(a,o,!1,function(t){s("gG/A")},"data-v-fd01a332",null).exports,l=s("zL8q"),r=s("xT6B"),h={name:"serviceDetail",components:{BatchWeightAdjust:c},data:function(){return{dataList:[],rsDataList:[],params:{env:1,nodeStatus:"",appKey:""},inRequest:!1,loading:s("F7NO"),currentIndex:0,titles:["prod","staging","ppe","test","dev"],env:1,selectList:[],unStart:0,forbidden:0,nodeType:"",closeCount:0,openCount:0,allCount:0,appKey:""}},mounted:function(){var t=this;this.appKey=this.$route.query.appKey,this.getSearchData(),n.$on("batchWeightData",function(e,s){t.batchWeightRequest(e,s)})},filters:{getStatus:function(t){return{0:"宕机",2:"存活",4:"停止"}[t]||""}},methods:{checkTime:function(t){return Object(r.a)(t)},activeClick:function(t){this.currentIndex=t,this.env=t+1,this.getSearchData()},switchNodeData:function(t){this.nodeType=t,this.getSearchData()},getSearchParams:function(){return{env:this.env,nodeStatus:this.nodeType,appKey:this.appKey}},getSearchData:function(){var t=this,e=this.getSearchParams();this.inRequest=!this.inRequest,Object(i.d)(e).then(function(e){t.inRequest=!t.inRequest,t.dataList=e.extra.nodeList,t.closeCount=e.extra.closeCount,t.openCount=e.extra.openCount,t.allCount=e.extra.allCount})},selectItem:function(t){var e=this.selectList.indexOf(t);e>-1?this.selectList.splice(e,1):this.selectList.push(t)},selectAllItem:function(){if(this.dataList.length>0&&this.dataList.length==this.selectList.length)this.selectList=[];else if(this.dataList.length>0&&this.dataList.length!=this.selectList.length){var t=[];this.dataList.some(function(e){t.push(e.ipAndPort)}),this.selectList=t}},nodeEnable:function(t){var e=this,s=this,n=1==t?"启用":"禁用";if(0!=this.selectList.length){var i={appKey:this.appKey,nodeList:this.getNodeList(),open:1==t?1:0};this.$confirm("确定"+n+"这些数据吗?","确定"+n,{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){s.nodeEnableRequest(t,i)}).catch(function(){e.$message({type:"info",message:"已取消"+n})})}else this.$message({message:"请选择需要"+n+"的数据项",showClose:!0,type:"error"})},openOrClose:function(t,e){var s=this,n=this,i={appKey:this.appKey,nodeList:[{ipAndPort:e.ipAndPort}],open:0===t?1:0},a=0===t?"启用":"禁用";this.$confirm("确定"+a+"这些数据吗?","确定"+a,{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){n.nodeEnableRequest(t,i)}).catch(function(){s.$message({type:"info",message:"已取消"+a})})},nodeEnableRequest:function(t,e){var s=this;Object(i.e)(e).then(function(e){s.$message({message:1==t?"节点启用操作成功":"节点禁用操作成功",type:"success",duration:1e3}),s.getSearchData()})},batchAdjust:function(t,e){1!=t||0!=this.selectList.length?this.$refs.batchWeightAdjustRef.show(t,e):this.$message({message:"请选择需要权重调整的数据项",showClose:!0,type:"error"})},batchWeightRequest:function(t,e){var s=this;1==e&&(t.nodeList=this.getNodeList()),t.appKey=this.appKey;var n=l.Loading.service(t);Object(i.a)(t).then(function(t){s.$nextTick(function(){n.close()}),s.$message({message:1==e?"批量权重调整操作成功":"权重调整操作成功",duration:1e3}),s.$refs.batchWeightAdjustRef.showBox=!1,s.getSearchData()}).catch(function(){s.$nextTick(function(){n.close()})})},getNodeList:function(){var t=[];return this.selectList.map(function(e,s){var n={ipAndPort:e};t.push(n)}),t},deleteService:function(t){var e=this,s=this;this.$confirm("是否要进行删除操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){s.deleteRequest(t)}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},deleteRequest:function(t){var e=this,s={appKey:this.appKey,ipAndPort:t.ipAndPort},n=this,a=l.Loading.service(s);Object(i.b)(s).then(function(t){e.$nextTick(function(){a.close()}),e.$message({message:"删除成功",type:"success",duration:1e3},function(t){n.getSearchData()})}).catch(function(){e.$nextTick(function(){a.close()})})},clearResult:function(){this.dataList=[]}}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"adjustTypeContainer"},[s("p",[s("span",{staticClass:"appKeyTitle"},[t._v(t._s(t.appKey))])]),t._v(" "),s("div",{staticClass:"adjustTypeItem"},t._l(t.titles,function(e,n){return s("span",{class:{active:t.currentIndex===n},on:{click:function(e){t.activeClick(n)}}},[t._v(t._s(e))])})),t._v(" "),s("p",{staticClass:"clear"})]),t._v(" "),s("div",{staticClass:"operateContainer"},[s("div",{staticClass:"operate-ul sn-f-cb"},[s("div",{staticClass:"titleLeft"},[s("label",{attrs:{for:"all"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.nodeType,expression:"nodeType"}],attrs:{type:"radio",name:"statusType",id:"all",value:""},domProps:{checked:t._q(t.nodeType,"")},on:{click:function(e){t.switchNodeData("")},change:function(e){t.nodeType=""}}}),t._v("\n        全部"),s("span",[t._v("  "),s("span",{staticClass:"iconFontColor"},[t._v(t._s(this.allCount))])])]),t._v(" "),s("label",{attrs:{for:"unStart"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.nodeType,expression:"nodeType"}],attrs:{type:"radio",name:"statusType",id:"unStart",value:"1"},domProps:{checked:t._q(t.nodeType,"1")},on:{click:function(e){t.switchNodeData(1)},change:function(e){t.nodeType="1"}}}),t._v("\n        启用"),s("span",[t._v("  "),s("span",{staticClass:"iconFontColor"},[t._v(t._s(this.openCount))])])]),t._v(" "),s("label",{attrs:{for:"forbidden"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.nodeType,expression:"nodeType"}],attrs:{type:"radio",name:"statusType",id:"forbidden",value:"0"},domProps:{checked:t._q(t.nodeType,"0")},on:{click:function(e){t.switchNodeData(0)},change:function(e){t.nodeType="0"}}}),t._v("\n        禁用"),s("span",[t._v("  "),s("span",{staticClass:"iconFontColor"},[t._v(t._s(this.closeCount))])])])]),t._v(" "),s("div",{staticClass:"titleRight"},[s("span",{on:{click:function(e){t.nodeEnable(1)}}},[t._v("节点启用")]),t._v(" "),s("span",{staticClass:"disabledStyle",on:{click:function(e){t.nodeEnable(2)}}},[t._v("节点禁用")]),t._v(" "),s("span",{on:{click:function(e){t.batchAdjust(1)}}},[t._v("权重调整")])])])]),t._v(" "),s("div",{staticClass:"reportContainer"},[s("table",{staticClass:"reportTable"},[s("thead",[s("tr",[s("th",[s("span",{staticClass:"btn-checkbox",class:{select:t.selectList.length>0&&t.dataList.length==t.selectList.length},on:{click:function(e){t.selectAllItem()}}})]),t._v(" "),s("th",[t._v("节点名称")]),t._v(" "),s("th",[t._v("IP")]),t._v(" "),s("th",[t._v("节点状态")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("端口")]),t._v(" "),s("th",[t._v("权重")]),t._v(" "),s("th",[t._v("机房")]),t._v(" "),s("th",[t._v("泳道")]),t._v(" "),s("th",[t._v("set")]),t._v(" "),s("th",[t._v("http分组")]),t._v(" "),s("th",[t._v("最后更新时间")]),t._v(" "),s("th",[t._v("操作")])])]),t._v(" "),0!=t.dataList.length||t.inRequest?t.inRequest?s("tr",[s("td",{staticClass:"locdingImg",staticStyle:{"text-align":"left","text-indent":"28px"},attrs:{colspan:"100"}},[s("img",{attrs:{src:t.loading}})])]):s("tbody",[t._l(t.dataList,function(e,n){return[s("tr",{key:n},[s("td",[s("span",{staticClass:"btn-checkbox",class:{select:t.selectList.indexOf(e.ipAndPort)>-1},on:{click:function(s){t.selectItem(e.ipAndPort)}}})]),t._v(" "),s("td",{staticClass:"aFontColor"},[t._v(t._s(e.nodeName||""))]),t._v(" "),s("td",[s("p",{staticClass:"omitStyle",attrs:{title:e.ip}},[t._v(t._s(e.ip||""))])]),t._v(" "),s("td",{class:[2==e.status?"nodeStatusStyle":0==e.status?"nodeRed":"nodeYellow"]},[t._v(t._s(t._f("getStatus")(e.status)))]),t._v(" "),s("td",[s("span",{staticClass:"serviceTypeStyle"},[t._v(t._s(e.type))])]),t._v(" "),s("td",{staticClass:"aFontColor"},[t._v(t._s(e.port||""))]),t._v(" "),s("td",[t._v(t._s(e.weight||""))]),t._v(" "),s("td",[t._v(t._s(e.machineRoom||"-"))]),t._v(" "),s("td",[t._v(t._s(e.lane||"-"))]),t._v(" "),s("td",[t._v(t._s(e.set||"-"))]),t._v(" "),s("td",[t._v(t._s(e.httpGroup||"-"))]),t._v(" "),s("td",[t._v(t._s(t.checkTime(e.lastUpdateTime)))]),t._v(" "),s("td",[s("a",{staticClass:"iconFontColor",class:{nodeRed:1==e.open},on:{click:function(s){t.openOrClose(e.open,e)}}},[t._v(t._s(1==e.open?"禁用":"启用")+"  ")]),t._v(" "),s("a",{staticClass:"iconFontColor",on:{click:function(s){t.batchAdjust(2,e)}}},[t._v("权重调整  ")]),t._v(" "),s("a",{staticClass:"iconFontColor",on:{click:function(s){t.deleteService(e)}}},[t._v("删除")])])])]})],2):s("tr",[s("td",{attrs:{colspan:"100"}},[t._v("暂无数据")])])]),t._v(" "),s("BatchWeightAdjust",{ref:"batchWeightAdjustRef"})],1)])},staticRenderFns:[]};var u=s("VU/8")(h,d,!1,function(t){s("Z1wl")},"data-v-7e625cb0",null);e.default=u.exports},Z1wl:function(t,e){},"gG/A":function(t,e){}});
//# sourceMappingURL=2.974106f94fd002872667.js.map
